# 秒杀系统



### 秒杀系统的逻辑

1. 秒杀开始的时候，会有大量用户同时参与进来，因此秒杀系统一定要满足 高并发和高性能 。
2. 为了保证秒杀整个流程的顺利进行，整个秒杀系统必须要满足 高可用 。
3. 除此之外，由于商品的库存有限，在面对大量订单的情况下，一定不能超卖，我们还需要保证 一致性 。



## 高性能



### 热点数据处理

处理热点数据的问题的关键就在于 我们如何找到这些热点数据（或者说热 key），然后将它们存在 jvm 内存里。 

**如何检测热点数据？**比如说我了解到市面上也有一些类似的中间件，比如说京东零售的hotkey就是一款专门用于检测热点数据的中间件，可以毫秒级探测热点数据，毫秒级推送至服务器集群内存。

**如何处理热点数据？**热点数据一定要放在缓存中，并且最好可以写入到 jvm 内存一份（多级缓存），并设置个过期时间。需要注意写入到 jvm 的热点数据不宜过多，避免内存占用过大，一定要设置到淘汰策略。



### 静态资源处理

秒杀会涉及到很多静态资源比如说商品图片、CSS、JS等等，就可以使用CDN的方法。



## 高可用



### 集群化

可以直接通过 Redis replication（异步复制） 搞个一主(master)多从(slave)来提高可用性和读吞吐量，slave 的多少取决于你的读吞吐量。

可以通过 Sentinel（哨兵） 来解决。Redis Sentinel 是 Redis 官方推荐的高可用性(HA)解决方案。



### 接口限流

1. **接口限流的话**可以直接用 Redis 来做（建议基于 Lua 脚本），也可以使用现成的流量控制组件比如 Sentinel 、Hystrix 、Resilience4J 。
2. **问题/验证码：**可以在用户发起秒杀请求之前让其进行答题或者输入验证码。
3. **提前预约：**可以对预约的这些人进行筛选，通过某些方式找出潜在的黄牛。
4. **流量削峰：**可以使用消息队列进行流量削峰。
5. **服务降级：****降级的核心思想就是丢车保帅，优先保证核心业务**