## CDN是什么？

CDN就是内容分发网络。可以拆分来看

- 内容 ：指的是静态资源比如图片、视频、文档、JS、CSS、HTML。

- 分发网络 ：指的是将这些静态资源分发到位于多个不同的地理位置机房中的服务器上，这样，就可以实现静态资源的就近访问比如北京的用户直接访问北京机房的数据。

CDN就是静态资源分发到多个不同的地方以实现就近访问，进而加快静态资源的访问速度，减轻服务器以及带宽的负担。



### 为什么不直接将服务部署在多个不同的地方

1. 成本太高，需要部署多份相同的服务。
2. 静态资源通常占用空间比较大且经常会被访问到，如果直接使用服务器或者缓存来处理静态资源请求的话，对系统资源消耗非常大，可能会影响到系统其他服务的正常运行。



## CDN工作原理是什么



### 静态资源是怎么被缓存到CDN节点中的？

1. 通过预热的方式将源站的资源同步到 CDN 的节点中。用户首次请求资源可以直接从CDN节点中取，无需回源。
2. **回源：**不预热的话，你访问的资源可能不再 CDN 节点中，这个时候 CDN 节点将请求源站获取资源。

**命中率** 和 **回源率** 是衡量 CDN 服务质量两个重要指标。

如果资源有更新的话，你也可以对其 **刷新** ，删除 CDN 节点上缓存的资源，当用户访问对应的资源时直接回源获取最新的资源，并重新缓存



### **如何找到最合适的 CDN 节点？**

GSLB （Global Server Load Balance，全局负载均衡）是 CDN 的大脑，负责多个CDN节点之间相互协作，最常用的是基于 DNS 的 GSLB。

**CDN 会通过 GSLB 找到最合适的 CDN 节点**

1. 浏览器向 DNS 服务器发送域名请求；
2. DNS 服务器向根据 CNAME别名记录向 GSLB 发送请求；
3. GSLB 返回性能最好（通常距离请求地址最近）的 CDN 节点（边缘服务器，真正缓存内容的地方）的地址给浏览器；
4. 浏览器直接访问指定的 CDN 节点。



### 如何防止资源被盗刷

最常用最简单的办法设置 **Referer 防盗链**，具体来说就是根据 HTTP 请求的头信息里面的 Referer 字段对请求进行限制。

但是如果站点的防盗链配置允许 Referer 为空的话，通过隐藏 Referer，可以直接绕开防盗链。

通常情况下，我们会配合其他机制来确保静态资源被盗用，一种常用的机制是 **时间戳防盗链** 。相比之下，**时间戳防盗链** 的安全性更强一些。